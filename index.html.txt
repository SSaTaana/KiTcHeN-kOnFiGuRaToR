<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Конфигуратор кухонной мебели</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/vfs_fonts.js"></script>
  <style>
    body {
      background-image: url('https://cdn.pixabay.com/photo/2025/05/25/12/17/kitchen-interior-8435524_1280.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      min-height: 100vh;
    }
    .container-overlay {
      background-color: rgba(0, 0, 0, 0.85);
      border-radius: 1rem;
      padding: 1.5rem;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center p-4">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
      const [roomParams, setRoomParams] = useState({ length: '', width: '', height: '' });
      const [budget, setBudget] = useState('');
      const [style, setStyle] = useState('');
      const [material, setMaterial] = useState('');
      const [color, setColor] = useState('');
      const [hasIsland, setHasIsland] = useState('');
      const [results, setResults] = useState([]);
      const [savedResults, setSavedResults] = useState([]);
      const [error, setError] = useState('');

      const kitchenDatabase = [
        { id: 1, name: "Классика Белая", length: 3.0, width: 2.0, height: 2.2, price: 150000, style: "Классический", material: "Дерево", color: "Белый", hasIsland: false, description: "Деревянная отделка, подходит для средних кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 2, name: "Модерн Серый", length: 2.5, width: 1.8, height: 2.0, price: 120000, style: "Модерн", material: "MDF", color: "Серый", hasIsland: false, description: "Минимализм, идеален для небольших помещений.", image: "https://images.unsplash.com/photo-1588850561407-ed78c282e89b?q=80&w=800&auto=format&fit=crop" },
        { id: 3, name: "Лофт Металл", length: 3.5, width: 2.5, height: 2.4, price: 200000, style: "Лофт", material: "Металл", color: "Чёрный", hasIsland: true, description: "Металлические элементы, для просторных кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 4, name: "Сканди Светлый", length: 2.8, width: 2.0, height: 2.1, price: 130000, style: "Скандинавский", material: "Дерево", color: "Белый", hasIsland: false, description: "Светлые тона, уютный дизайн.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 5, name: "Премиум Мрамор", length: 4.0, width: 3.0, height: 2.5, price: 300000, style: "Премиум", material: "Мрамор", color: "Белый", hasIsland: true, description: "Мраморная отделка, для больших кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 6, name: "Рустик Дуб", length: 3.2, width: 2.2, height: 2.3, price: 180000, style: "Рустик", material: "Дуб", color: "Коричневый", hasIsland: false, description: "Дубовая текстура, для теплых интерьеров.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 7, name: "Хай-тек Черный", length: 2.7, width: 1.9, height: 2.1, price: 140000, style: "Хай-тек", material: "MDF", color: "Чёрный", hasIsland: false, description: "Глянцевый черный, для современных кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 8, name: "Прованс Пастель", length: 3.1, width: 2.1, height: 2.2, price: 160000, style: "Прованс", material: "Дерево", color: "Пастель", hasIsland: false, description: "Пастельные тона, для романтичных интерьеров.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 9, name: "Минимал Синий", length: 2.6, width: 1.7, height: 2.0, price: 110000, style: "Минимализм", material: "MDF", color: "Синий", hasIsland: false, description: "Синий акцент, компактный дизайн.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 10, name: "Эко Дерево", length: 3.4, width: 2.3, height: 2.4, price: 220000, style: "Эко", material: "Дерево", color: "Коричневый", hasIsland: true, description: "Естественные материалы, экологичный выбор.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 11, name: "Классика Кремовая", length: 3.3, width: 2.1, height: 2.3, price: 170000, style: "Классический", material: "Дерево", color: "Кремовый", hasIsland: false, description: "Кремовые оттенки, для элегантных интерьеров.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 12, name: "Модерн Белый", length: 2.9, width: 2.0, height: 2.2, price: 125000, style: "Модерн", material: "MDF", color: "Белый", hasIsland: false, description: "Белый минимализм, для светлых кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 13, name: "Лофт Бетон", length: 3.6, width: 2.6, height: 2.5, price: 210000, style: "Лофт", material: "Бетон", color: "Серый", hasIsland: true, description: "Бетонная отделка, для индустриального стиля.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 14, name: "Сканди Серый", length: 2.7, width: 1.9, height: 2.1, price: 135000, style: "Скандинавский", material: "Дерево", color: "Серый", hasIsland: false, description: "Серые акценты, для скандинавских интерьеров.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 15, name: "Премиум Черный", length: 4.2, width: 3.2, height: 2.6, price: 320000, style: "Премиум", material: "Мрамор", color: "Чёрный", hasIsland: true, description: "Чёрный мрамор, для роскошных кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 16, name: "Рустик Орех", length: 3.1, width: 2.0, height: 2.2, price: 175000, style: "Рустик", material: "Орех", color: "Коричневый", hasIsland: false, description: "Ореховая отделка, для деревенского стиля.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 17, name: "Хай-тек Белый", length: 2.8, width: 2.0, height: 2.1, price: 145000, style: "Хай-тек", material: "MDF", color: "Белый", hasIsland: true, description: "Глянцевый белый, для современных интерьеров.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 18, name: "Прованс Белый", length: 3.0, width: 2.2, height: 2.3, price: 165000, style: "Прованс", material: "Дерево", color: "Белый", hasIsland: false, description: "Белый прованс, для романтичных кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 19, name: "Минимал Белый", length: 2.5, width: 1.8, height: 2.0, price: 115000, style: "Минимализм", material: "MDF", color: "Белый", hasIsland: false, description: "Белый минимализм, для компактных кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
        { id: 20, name: "Эко Белый", length: 3.3, width: 2.2, height: 2.4, price: 230000, style: "Эко", material: "Дерево", color: "Белый", hasIsland: true, description: "Экологичный белый дизайн, для больших кухонь.", image: "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?q=80&w=800&auto=format&fit=crop" },
      ];

      const styles = ['Классический', 'Модерн', 'Лофт', 'Скандинавский', 'Премиум', 'Рустик', 'Хай-тек', 'Прованс', 'Минимализм', 'Эко'];
      const materials = ['Дерево', 'MDF', 'Мрамор', 'Металл', 'Бетон', 'Орех'];
      const colors = ['Белый', 'Серый', 'Чёрный', 'Коричневый', 'Пастель', 'Синий', 'Кремовый'];

      useEffect(() => {
        const saved = localStorage.getItem('savedKitchenResults');
        if (saved) setSavedResults(JSON.parse(saved));
      }, []);

      const handleInputChange = (e, field) => {
        const value = e.target.value;
        if (field === 'length' || field === 'width' || field === 'height' || field === 'budget') {
          if (value === '' || (Number(value) >= 0 && !isNaN(value))) {
            if (field === 'budget') setBudget(value);
            else setRoomParams({ ...roomParams, [field]: value });
          }
        } else if (field === 'style') setStyle(value);
        else if (field === 'material') setMaterial(value);
        else if (field === 'color') setColor(value);
        else if (field === 'hasIsland') setHasIsland(value === 'yes');
        setError('');
      };

      const findBestOptions = () => {
        const { length, width, height } = roomParams;
        const budgetValue = parseFloat(budget);

        if (!length || !width || !height || !budget) {
          setError('Пожалуйста, заполните все поля размеров и бюджета.');
          setResults([]);
          return;
        }

        if (isNaN(length) || isNaN(width) || isNaN(height) || isNaN(budgetValue) || length <= 0 || width <= 0 || height <= 0 || budgetValue <= 0) {
          setError('Введите корректные числовые значения больше 0.');
          setResults([]);
          return;
        }

        const tolerance = 0.1;
        let filteredOptions = kitchenDatabase.map(option => {
          const lengthFit = option.length <= parseFloat(length) * (1 + tolerance);
          const widthFit = option.width <= parseFloat(width) * (1 + tolerance);
          const heightFit = option.height <= parseFloat(height) * (1 + tolerance);
          const priceFit = option.price <= budgetValue * (1 + tolerance);

          let priority = 1.0;
          if (lengthFit) priority *= 1.0; else priority *= 0.8;
          if (widthFit) priority *= 1.0; else priority *= 0.8;
          if (heightFit) priority *= 1.0; else priority *= 0.8;
          if (priceFit) priority *= 1.0; else priority *= 0.9;

          return { ...option, priority };
        }).filter(option => {
          return option.length <= parseFloat(length) * (1 + tolerance) &&
                 option.width <= parseFloat(width) * (1 + tolerance) &&
                 option.height <= parseFloat(height) * (1 + tolerance) &&
                 option.price <= budgetValue * (1 + tolerance);
        });

        if (style) filteredOptions = filteredOptions.filter(option => option.style === style);
        if (material) filteredOptions = filteredOptions.filter(option => option.material === material);
        if (color) filteredOptions = filteredOptions.filter(option => option.color === color);
        if (hasIsland !== '') filteredOptions = filteredOptions.filter(option => option.hasIsland === hasIsland);

        const sortedOptions = filteredOptions.sort((a, b) => b.priority - a.priority || b.price - a.price).slice(0, 3);
        if (sortedOptions.length === 0) {
          setError('Не найдено подходящих вариантов для заданных параметров.');
          setResults([]);
        } else {
          setResults(sortedOptions);
          setError('');
        }
      };

      const saveResults = () => {
        if (results.length > 0) {
          const newSaved = [...savedResults, { id: Date.now(), data: results, params: { ...roomParams, budget, style, material, color, hasIsland }, timestamp: new Date().toLocaleString() }];
          setSavedResults(newSaved);
          localStorage.setItem('savedKitchenResults', JSON.stringify(newSaved));
          alert('Результаты сохранены!');
        }
      };

      const exportToPDF = () => {
        if (results.length > 0) {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();

          // Загрузка шрифта для поддержки кириллицы
          const fontUrl = 'https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.68/fonts/Roboto/Roboto-Regular.ttf';
          doc.addFileToVFS('Roboto-Regular.ttf', window.pdfMake.vfs['Roboto-Regular.ttf']);
          doc.addFont('Roboto-Regular.ttf', 'Roboto', 'normal');
          doc.setFont('Roboto');

          // Установка размера шрифта и добавление текста
          doc.setFontSize(16);
          doc.text('Рекомендуемые варианты кухонной мебели', 10, 10);
          doc.setFontSize(12);
          doc.text(`Параметры комнаты: Длина ${roomParams.length} м, Ширина ${roomParams.width} м, Высота ${roomParams.height} м, Бюджет: ${budget} руб.`, 10, 20);
          if (style) doc.text(`Стиль: ${style}`, 10, 30);
          if (material) doc.text(`Материал: ${material}`, 10, 40);
          if (color) doc.text(`Цвет: ${color}`, 10, 50);
          doc.text(`Остров: ${hasIsland ? 'Да' : 'Нет'}`, 10, 60);

          let yOffset = 70;
          results.forEach((option, index) => {
            doc.text(`${index + 1}. ${option.name}`, 10, yOffset);
            doc.text(`Цена: ${option.price} руб.`, 10, yOffset + 10);
            doc.text(`Размеры: ${option.length} x ${option.width} x ${option.height} м`, 10, yOffset + 20);
            doc.text(`Стиль: ${option.style}, Материал: ${option.material}, Цвет: ${option.color}`, 10, yOffset + 30);
            doc.text(`Остров: ${option.hasIsland ? 'Да' : 'Нет'}`, 10, yOffset + 40);
            doc.text(`Описание: ${option.description}`, 10, yOffset + 50);
            yOffset += 60;
            if (yOffset > 260) {
              doc.addPage();
              yOffset = 10;
            }
          });

          doc.save(`kitchen_config_${new Date().toISOString().split('T')[0]}.pdf`);
          alert('PDF-файл сохранён!');
        }
      };

      return (
        <div className="max-w-5xl w-full container-overlay shadow-lg border border-gray-700">
          <h1 className="text-3xl font-bold text-center text-white mb-6">Конфигуратор кухонной мебели</h1>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label className="block text-gray-300 mb-2">Длина помещения (м):</label>
              <input
                type="number"
                value={roomParams.length}
                onChange={(e) => handleInputChange(e, 'length')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Например, 3.5"
                step="0.1"
                min="0"
              />
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Ширина помещения (м):</label>
              <input
                type="number"
                value={roomParams.width}
                onChange={(e) => handleInputChange(e, 'width')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Например, 2.0"
                step="0.1"
                min="0"
              />
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Высота помещения (м):</label>
              <input
                type="number"
                value={roomParams.height}
                onChange={(e) => handleInputChange(e, 'height')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Например, 2.4"
                step="0.1"
                min="0"
              />
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Бюджет (руб):</label>
              <input
                type="number"
                value={budget}
                onChange={(e) => handleInputChange(e, 'budget')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                placeholder="Например, 150000"
                step="1000"
                min="0"
              />
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Стиль:</label>
              <select
                value={style}
                onChange={(e) => handleInputChange(e, 'style')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Выберите стиль</option>
                {styles.map(s => <option key={s} value={s}>{s}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Материал:</label>
              <select
                value={material}
                onChange={(e) => handleInputChange(e, 'material')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Выберите материал</option>
                {materials.map(m => <option key={m} value={m}>{m}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Цвет:</label>
              <select
                value={color}
                onChange={(e) => handleInputChange(e, 'color')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Выберите цвет</option>
                {colors.map(c => <option key={c} value={c}>{c}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-gray-300 mb-2">Наличие острова:</label>
              <select
                value={hasIsland ? 'yes' : 'no'}
                onChange={(e) => handleInputChange(e, 'hasIsland')}
                className="w-full p-2 border rounded bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                <option value="">Не важно</option>
                <option value="yes">Да</option>
                <option value="no">Нет</option>
              </select>
            </div>
          </div>

          <div className="text-center mb-6 space-x-4">
            <button
              onClick={findBestOptions}
              className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition duration-200"
            >
              Подобрать варианты
            </button>
            <button
              onClick={saveResults}
              disabled={results.length === 0}
              className="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition duration-200 disabled:bg-gray-400"
            >
              Сохранить результаты
            </button>
            <button
              onClick={exportToPDF}
              disabled={results.length === 0}
              className="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition duration-200 disabled:bg-gray-400"
            >
              Экспорт в PDF
            </button>
          </div>

          {error && (
            <div className="text-red-400 text-center mb-6">{error}</div>
          )}

          {results.length > 0 && (
            <div>
              <h2 className="text-2xl font-semibold text-center text-white mb-4">Рекомендуемые варианты:</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                {results.map(option => (
                  <div key={option.id} className="bg-gray-800 p-4 rounded-lg shadow">
                    <img src={option.image} alt={option.name} className="w-full h-48 object-cover rounded-lg mb-4 border border-gray-600" />
                    <h3 className="text-xl font-bold text-white">{option.name}</h3>
                    <p className="text-gray-300">Цена: {option.price} руб.</p>
                    <p className="text-gray-300">Размеры: {option.length} x {option.width} x {option.height} м</p>
                    <p className="text-gray-300">Стиль: {option.style}</p>
                    <p className="text-gray-300">Материал: {option.material}</p>
                    <p className="text-gray-300">Цвет: {option.color}</p>
                    <p className="text-gray-300">Остров: {option.hasIsland ? 'Да' : 'Нет'}</p>
                    <p className="text-gray-300">Описание: {option.description}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>